openapi: 3.0.0
info:
  title: ECG Balance Calculator
  version: 2.1.1
paths:
  /v1/users/token:
    post:
      tags:
        - "users"
      requestBody:
        content:
          'application/json':
            schema:
              $ref: '#/components/schemas/UserBody'
            examples:
              UserExample:
                $ref: '#/components/examples/UserExample'
        required: true
      security: [ ]
      summary: Get token for user
      responses:
        '200': # status code
          description: Token response
          content:
            application/json:
              schema:
                type: object
                properties:
                  token:
                    type: string
                  expires:
                    type: string
                  user:
                    type: integer
  /v1/balancesheets:
    get:
      parameters:
        - in: header
          name: x-correlation-id
          description: "If x-correlation-id is set then it's value will be used as the id for this request, otherwise the id will be a new uuid."
          required: false
          schema:
            type: string
      security:
        - bearerAuth: [ ]
      tags:
        - "balancesheets"
      summary: Returns all balance sheets to which the current user has access
      responses:
        '200': # status code
          description: An array of the user's balance sheets
          content:
            application/json:
              schema:
                type: array
                items:
                  type: object
                  properties:
                    id:
                      type: number
                      description: Id of balance sheet
    post:
      tags:
        - "balancesheets"
      parameters:
        - in: query
          name: save
          description: "If true, the results of the balance sheet calculations are saved in the database. Otherwise, not."
          required: false
          schema:
            type: boolean
            default: true
        - in: query
          name: lng
          description: "Choose the language. All words are translated to the given language."
          required: false
          schema:
            type: string
            default: en
            enum:
              - en
              - de
        - in: header
          name: x-correlation-id
          description: "If x-correlation-id is set then it's value will be used as the id for this request, otherwise the id will be a new uuid."
          required: false
          schema:
            type: string
      requestBody:
        content:
          'application/json':
            schema:
              $ref: '#/components/schemas/BalanceSheetBody'
            examples:
              Full 5.06:
                $ref: '#/components/examples/Full_5_0_6_Body'
        required: true
      security:
        - bearerAuth: [ ]
      summary: Create a balance sheet
      responses:
        '200': # status code
          description: Created balance sheet
          content:
            "application/json":
              schema:
                $ref: "#/components/schemas/BalanceSheetResponse"
              examples:
                Full 5.06:
                  $ref: '#/components/examples/Full_5_0_6_Response'
  /v1/regions:
    get:
      parameters:
        - in: header
          name: x-correlation-id
          description: "If x-correlation-id is set then it's value will be used as the id for this request, otherwise the id will be a new uuid."
          required: false
          schema:
            type: string
        - in: query
          name: lng
          description: "Choose the language. All country names are translated to the given language."
          required: false
          schema:
            type: string
            default: en
            enum:
              - en
              - de
      security:
        - bearerAuth: [ ]
      tags:
        - "regions"
      summary: "Returns all regions which are valid for the given balance sheet version"
      responses:
        '200': # status code
          description: An array of the regions
          content:
            application/json:
              schema:
                type: array
                items:
                  type: object
                  properties:
                    countryCode:
                      type: string
                      description: "The country code of the region (e.g. DEU, BEL)"
                    countryName:
                      type: string
                      description: "The country name of the region (e.g. Germany, Belgium)"
              examples:
                Example of regions:
                  value:
                    - countryCode: "DEU"
                      countryName: "Germany"
                    - countryCode: "ALB"
                      countryName: "Albania"
components:
  securitySchemes:
    bearerAuth: # arbitrary name for the security scheme
      type: http
      scheme: bearer
      bearerFormat: JWT
  schemas:
    BalanceSheetBody:
      type: object
      properties:
        type:
          type: string
          enum: [ Full, Compact ]
          description: Balance Sheet type
        version:
          type: string
          enum: [ '5.04' ]
          description: Balance Sheet version
        companyFacts:
          $ref: '#/components/schemas/CompanyFactsBody'
        ratings:
          type: array
          items:
            $ref: '#/components/schemas/RatingsBody'
          description: You can pass only a subset of the required topics/ aspects. For the rest default values are used.
          default: Default rating is generated for given balance sheet type and version
      required:
        - type
        - version
    CompanyFactsBody:
      type: object
      properties:
        totalPurchaseFromSuppliers:
          type: number
          format: Postive monatary value
          description: Total purchase from suppliers in €
          default: 0
        totalStaffCosts:
          type: number
          format: Postive monatary value
          description: Total staff costs in €
          default: 0
        profit:
          type: number
          format: Monatary value
          description: Profit in €
          default: 0
        financialCosts:
          type: number
          format: Positive monatary value
          description: Financial costs in €
          default: 0
        incomeFromFinancialInvestments:
          type: number
          format: Monatary value
          description: Income from financial investments in €
          default: 0
        additionsToFixedAssets:
          type: number
          format: Monatary value
          description: Additions to fixed assets in €
          default: 0
        turnover:
          type: number
          format: Positive monatary value
          description: Turnover
          default: 0
        totalAssets:
          type: number
          format: Positive monatary value
          description: Total assets
          default: 0
        financialAssetsAndCashBalance:
          type: number
          format: Positive monatary value
          description: Financial assets and cash balance
          default: 0
        numberOfEmployees:
          type: number
          format: Positive value
          description: Number of employees
          default: 0
        hasCanteen:
          type: boolean
          format: true or false
          description: True, if company has its own canteen. Otherwise, false.
          default: false
        averageJourneyToWorkForStaffInKm:
          type: number
          format: Positive value
          description: Average journey to work for staff in kilometers
          default: 0
        isB2B:
          type: boolean
          format: true or false
          description: True, if the company's customers are mainly other companies (=B2B).
          default: false
        supplyFractions:
          type: array
          items:
            $ref: '#/components/schemas/SupplyFractionsBody'
          default: [ ]
        mainOriginOfOtherSuppliers:
          type: string
          format: ISO\-3166 Alpha3 country code
          description: The country of origin of the other suppliers which are not explicetly defined.
          default: World
        employeesFractions:
          type: array
          items:
            $ref: '#/components/schemas/EmployeesFractionsBody'
          default: [ ]
        industrySectors:
          type: array
          items:
            $ref: '#/components/schemas/IndustrySectorBody'
          default: [ ]

    SupplyFractionsBody:
      type: object
      properties:
        countryCode:
          type: string
          maxLength: 3
          format: ISO\-3166 Alpha3 country code
          description: The supplier's country of origin
        costs:
          type: number
          format: Positive monetary value in €
          description: The costs for the supplier
          default: 0
        industryCode:
          type: string
          format: The industry code of the Excel sheet 10. Industry
          description: Industry code in which the supplier is active
      required:
        - industryCode
        - countryCode
    EmployeesFractionsBody:
      type: object
      properties:
        countryCode:
          type: string
          maxLength: 3
          format: ISO\-3166 Alpha3 country code
          description: The subsidiary's country of origin
        percentage:
          type: number
          format: Valid percentage value within [0,1]
          description: The subsidiary's percentage of employees
          default: 0
      required:
        - countryCode

    IndustrySectorBody:
      type: object
      properties:
        industryCode:
          type: string
          format: The industry code of the Excel sheet 10. Industry
          description: The industry code of the industry sector
        description:
          type: string
          description: Description of the industry
          default: ''
        amountOfTotalTurnover:
          type: number
          format: Valid percentage value within [0,1]
          description: Amount of total turnover of the industry sector
      required:
        - industryCode

    RatingsBody:
      type: object
      properties:
        shortName:
          type: string
          description: The short name of the topic/ aspect
        estimations:
          type: number
          format: Value within [-200, 10]
          description: The estimations of the topic/ aspect
          default: 0
        weight:
          type: number
          format: Valid weight value within [0, 0.5, 1, 1.5, 2]
          description: The weight of the topic/ aspect
          default: Default weight for this topic/ aspect
      required:
        - shortName
    UserBody:
      type: object
      properties:
        email:
          type: string
          format: email
        password:
          type: string
          format: password
      required:
        - email
        - password
    BalanceSheetResponse:
      type: object
      properties:
        id:
          type: number
          description: Auto generated id
        type:
          type: string
          enum: [ Full, Compact ]
          description: Balance Sheet type
        version:
          type: string
          enum: [ '5.04' ]
          description: Balance Sheet version
        ratings:
          $ref: '#/components/schemas/RatingsResponse'
        companyFacts:
          $ref: '#/components/schemas/CompanyFactsResponse'
      required:
        - type
        - version

    RatingsResponse:
      type: array
      items:
        type: object
        properties:
          shortName:
            type: string
            description: Short name of the rating (e.g. A1 or A1.2)
          name:
            type: string
            description: Name of the rating
          weight:
            type: number
            description: The weight of the rating
          estimations:
            type: number
            description: The estimations of the rating
          points:
            type: number
            description: The points of the rating
          maxPoints:
            type: number
            description: The max points of the rating
          type:
            type: string
            description: The type of the rating
            enum:
              - topic
              - aspect
          isPositive:
            type: boolean
            description: True if it is a positive aspect. False otherwise.

    CompanyFactsResponse:
      type: object
      properties:
        totalPurchaseFromSuppliers:
          type: number
          format: Postive monatary value
          description: Total purchase from suppliers in €
          default: 0
        totalStaffCosts:
          type: number
          format: Postive monatary value
          description: Total staff costs in €
        profit:
          type: number
          format: Monatary value
          description: Profit in €
        financialCosts:
          type: number
          format: Positive monatary value
          description: Financial costs in €
        incomeFromFinancialInvestments:
          type: number
          format: Positive monatary value
          description: Income from financial investments in €
        additionsToFixedAssets:
          type: number
          format: Positive monatary value
          description: Additions to fixed assets in €
        turnover:
          type: number
          format: Positive monatary value
          description: Turnover
        totalAssets:
          type: number
          format: Positive monatary value
          description: Total assets
        financialAssetsAndCashBalance:
          type: number
          format: Positive monatary value
          description: Financial assets and cash balance
        numberOfEmployees:
          type: number
          format: Positive value
          description: Number of employees
        hasCanteen:
          type: boolean
          format: true or false
          description: True, if company has its own canteen. Otherwise, false.
        averageJourneyToWorkForStaffInKm:
          type: number
          format: Positive value
          description: Average journey to work for staff in kilometers
        isB2B:
          type: boolean
          format: true or false
          description: True, if the company's customers are mainly other companies (=B2B).
        supplyFractions:
          type: array
          items:
            $ref: '#/components/schemas/SupplyFractionsResponse'
        mainOriginOfOtherSuppliers:
          $ref: '#/components/schemas/MainOriginOfOtherSuppliersResponse'
        employeesFractions:
          type: array
          items:
            $ref: '#/components/schemas/EmployeesFractionsResponse'
        industrySectors:
          type: array
          items:
            $ref: '#/components/schemas/IndustrySectorResponse'

      required:
        - totalPurchaseFromSuppliers
        - totalStaffCosts
        - profit
        - financialCosts
        - incomeFromFinancialInvestments
        - additionsToFixedAssets
        - turnover
        - totalAssets
        - financialAssetsAndCashBalance
        - numberOfEmployees
        - hasCanteen
        - averageJourneyToWorkForStaffInKm
        - isB2B

    MainOriginOfOtherSuppliersResponse:
      type: object
      properties:
        countryCode:
          type: string
          format: ISO\-3166 Alpha3 country code
          description: The country of origin of the other suppliers which are not explicetly defined.
        costs:
          type: number
          format: Monetary value in €
          description: The costs are equal to totalPurchaseFromSuppliers - sum costs of all suppliers.

    SupplyFractionsResponse:
      type: object
      properties:
        countryCode:
          type: string
          maxLength: 3
          format: ISO\-3166 Alpha3 country code
          description: The supplier's country of origin
        costs:
          type: number
          format: Positive monetary value in €
          description: The costs for the supplier
        industryCode:
          type: string
          format: The industry code of the Excel sheet 10. Industry
          description: Industry code in which the supplier is active
    EmployeesFractionsResponse:
      type: object
      properties:
        countryCode:
          type: string
          maxLength: 3
          format: ISO\-3166 Alpha3 country code
          description: The subsidiary's country of origin
        percentage:
          type: number
          format: Valid percentage value within [0,1]
          description: The subsidiary's percentage of employees

    IndustrySectorResponse:
      type: object
      properties:
        industryCode:
          type: string
          format: The industry code of the Excel sheet 10. Industry
          description: The industry code of the industry sector
        description:
          type: string
          description: Description of the industry
        amountOfTotalTurnover:
          type: number
          format: Valid percentage value within [0,1]
      description: Amount of total turnover of the industry sector
  examples:
    UserExample: # Example 1
      value:
        email: "user@example.org"
        password: "example_pZZgAHj791VdLZlsB0xU"
    Full_5_0_6_Body:
      value:
        type: 'Full'
        version: '5.06'
        ratings:
          - shortName: 'A1.1'
            estimations: 2
          - shortName: "B2.2"
            estimations: -100
          - shortName: "B3.1"
            estimations: 8
            weight: 1.5
        companyFacts:
          totalPurchaseFromSuppliers: 300
          totalStaffCosts: 100
          profit: 3070
          financialCosts: 19
          incomeFromFinancialInvestments: 201
          additionsToFixedAssets: 102
          turnover: 500
          totalAssets: 200
          financialAssetsAndCashBalance: 100
          numberOfEmployees: 1
          hasCanteen: true
          averageJourneyToWorkForStaffInKm: 5.3
          isB2B: true
          mainOriginOfOtherSuppliers: "DEU"
          supplyFractions:
            - industryCode: "A"
              countryCode: "DEU"
              costs: 300
            - industryCode: "Ce"
              countryCode: "DEU"
              costs: 300
          employeesFractions:
            - countryCode: "DEU"
              percentage: 0.8
          industrySectors:
            - industryCode: "A"
              description: "Beschreibung der Industrie"
              amountOfTotalTurnover: 1
    Full_5_0_6_Response:
      value:
        type: 'Full'
        version: '5.06'
        ratings:
          - shortName: "A1"
            name: "Human dignity in the supply chain"
            weight: 1
            estimations: 0
            points: 4.938271604938271
            maxPoints: 24.691358024691358
            isPositive: true
            type: "topic"
          - shortName: "A1.1"
            name: "Working conditions and social impact in the supply chain"
            weight: 1
            estimations: 2
            points: 4.938271604938271
            maxPoints: 24.691358024691358
            isPositive: true
            type: "aspect"
          - shortName: "A1.2"
            name: "Negative aspect: violation of human dignity in the supply chain"
            weight: 1
            estimations: 0
            points: 0
            maxPoints: -98.76543209876543
            isPositive: false
            type: "aspect"
          - shortName: "E4.3"
            name: "Negative aspect: lack of transparency and wilful misinformation"
            weight: 1
            estimations: 0
            points: 0
            maxPoints: -98.76543209876543
            isPositive: false
            type: "aspect"
        companyFacts:
          totalPurchaseFromSuppliers: 300
          totalStaffCosts: 100
          profit: 3070
          financialCosts: 19
          incomeFromFinancialInvestments: 201
          additionsToFixedAssets: 102
          turnover: 500
          totalAssets: 200
          financialAssetsAndCashBalance: 100
          numberOfEmployees: 1
          hasCanteen: true
          averageJourneyToWorkForStaffInKm: 5.3
          isB2B: true
          mainOriginOfOtherSuppliers: "DEU"
          supplyFractions:
            - industryCode: "A"
              countryCode: "DEU"
              costs: 300
            - industryCode: "Ce"
              countryCode: "DEU"
              costs: 300
          employeesFractions:
            - countryCode: "DEU"
              percentage: 0.8
          industrySectors:
            - industryCode: "A"
              description: "Beschreibung der Industrie"
              amountOfTotalTurnover: 1
